# Discrete-to-ASIC Delta-Sigma Acquisition System
（ディスクリート・ASIC連携によるデルタシグマデータ収集システム）

## 1. プロジェクト概要
本プロジェクトは、アナログ信号処理（PCB）とデジタル信号処理（ASIC）を統合した、ハードウェア・イン・ザ・ループ（HIL）構成のデータ収集システム構築プロジェクトです。
Tiny Tapeout（130nmプロセス）を用いて**CICデシメーションフィルタ**をASIC上に実装し、自作のディスクリート・デルタシグマ変調器（外部基板）からの1bit PDM信号をデシメーション処理・復調します。

本設計の主目的は、単なる回路実装にとどまらず、アナログ・フロントエンドからデジタル・バックエンドまでを設計・検証し、ミックスドシグナル・システムの統合プロセスを実証することにあります。

## 2. 開発ステータスとロードマップ (Status & Roadmap)
現在、ASIC側の論理設計および検証が完了しており、ファウンドリへの製造委託（テープアウト）に向けた最終調整段階にあります。

### Phase 1: ASIC論理設計・検証 【完了 (Done)】
* **RTL実装:** Verilog-2001によるCICフィルタの記述完了。
* **Pre-Silicon検証:** オープンEDAツール（Icarus Verilog）を用いたシミュレーションを実施済み。
    * テストベンチ内でPDM変調モデルを構築し、1kHz正弦波の入力に対してASIC回路が正しく復調・デシメーション動作を行うことを波形レベルで確認しました。
 
    * <img width="836" height="259" alt="image" src="https://github.com/user-attachments/assets/f00456fd-f33d-4d7d-936f-e93db4e70c2f" />


### Phase 2: テープアウト・PCB設計 【計画 (Planned)】
* **テープアウト:** 2026年3月のTiny Tapeout IHPシャトルへ提出予定。
* **PCB開発:** ASIC製造期間（待ち時間）を利用し、アナログフロントエンド基板の設計・製造を行います。確定したASICのピン配置や電気的特性に合わせて最適化を行います。

### Phase 3: 実機評価 (System Validation) 【2026年9月予定】
* **実チップ納品:** 2026年9月頃のチップ到着に合わせて、PCBとASICを結合。
* **統合テスト:** Digilent Analog Discoveryを用いた実波形観測により、S/N比や周波数応答の評価を実施します。

## 3. 設計思想 (Design Philosophy)
本設計では、Tiny Tapeoutのリソース制約（Area/IO）と信号処理精度（Signal Integrity）のトレードオフを考慮し、以下の技術的判断を行いました。

### (1) クロック同期戦略 (Clock Domain Strategy)
* **課題:** アナログ変調器（PCB）とデジタルフィルタ（ASIC）が別々のクロック源で動作すると、サンプリング時のジッタやセットアップ/ホールド違反によりノイズフロアが上昇する懸念があった。
* **決定:** **完全同期システム**として設計。
* **根拠:** データ収集の品質を最優先するため、PCB側のサンプリングクロックとASIC側のシステムクロックを単一のソース（または同期したソース）から供給する構成とした。目標周波数はオーディオ帯域のオーバーサンプリングに適した **2.048 MHz** に設定。

### (2) フィルタ次数の選定 (Filter Order Selection)
* **課題:** 回路面積を最小化しつつ、量子化ノイズを適切に除去する必要があった。
* **決定:** **3次 (N=3) CICフィルタ**を採用。
* **根拠:** フロントエンドのデルタシグマ変調器が「2次」であるため、理論上、量子化ノイズ整形（Noise Shaping）の傾きに対応するには「L+1 = 3次」のフィルタが最適であると判断。不必要に高次なフィルタによる面積増大を回避した。

### (3) デシメーション率と帯域設計 (Decimation & Bandwidth)
* **課題:** 入力サンプリングレートに対し、実用的な信号帯域を確保する必要がある。
* **決定:** **デシメーション率 R=32** (固定)。
* **根拠:** 2.048 MHzの入力に対し、R=32で間引くことで出力レートは **64 kHz** となる。ナイキスト周波数(32kHz)内に可聴帯域(20kHz)を余裕を持って収めることができ、かつCICの通過帯域特性も平坦部を使用できる計算結果に基づいている。

### (4) 内部ビット幅と出力インターフェース (Bit Width & I/O)
* **課題:** Tiny Tapeoutの出力ピン数は8本に限られており、CICフィルタの広大なダイナミックレンジ（最大16bit）をそのまま出力できない。
* **決定:** 内部演算は**16bit**、出力は**上位8bit切り出し (Truncation)**。
* **根拠:**
    * **内部:** $B_{out} = B_{in} + N \log_2 R$ の計算式に基づき、1bit入力・N=3・R=32の場合にオーバーフローなく情報を保持できる16bit幅を確保。
    * **出力:** シリアル通信による全ビット出力よりも、ロジックアナライザでの**「リアルタイム波形観測」**を優先し、MSB側8bitのパラレル出力を選択した。下位ビットの切り捨てによる量子化誤差は、機能検証の目的において許容範囲とした。

### (5) 電圧レベルの整合性 (Voltage Compatibility)
* **決定:** **3.3V LVCMOS** 準拠。
* **根拠:** Tiny Tapeout Demo Boardの標準IO電圧に合わせ、外部PCB側のアナログ回路およびコンパレータ出力も3.3V単一電源で設計することで、レベルシフタ等の追加回路を排除し、システムをシンプルに保つ。

## 4. 技術仕様 (Specifications)

### システム全体仕様
| 項目 | 仕様 | 備考 |
| :--- | :--- | :--- |
| **入力フォーマット** | 1-bit PDM (Pulse Density Modulation) | 自作外部基板（2次変調器）より入力予定 |
| **ロジック電圧** | 3.3V (LVCMOS) | Tiny Tapeout Demo Board準拠 |
| **動作クロック** | 2.048 MHz | 外部基板のサンプリングレートと同期 |
| **信号帯域** | ~10 kHz | 音声・センサ帯域を想定 |

### ASIC内部（CICフィルタ）仕様
| パラメータ | 設定値 | 設計根拠 |
| :--- | :--- | :--- |
| **次数 ($N$)** | 3 | 2次デルタシグマ変調の量子化ノイズ整形に対応 |
| **デシメーション率 ($R$)** | 32 | 2.048 MHz入力 → 64 kHz出力 |
| **遅延 ($M$)** | 1 | 標準構成 |
| **内部ビット幅** | 16-bit | オーバーフローを許容するラップアラウンド演算用に設計 ($B_{out} = B_{in} + N \log_2 R$) |
| **出力ビット幅** | 8-bit | 外部ピン数制約に合わせMSB側8bitを出力 |

## 5. 使用ツール・環境
* **HDL:** Verilog-2001
* **Simulation:** Icarus Verilog, GTKWave (EDA Playground)
* **Implementation:** Tiny Tapeout IHP 130nm Open Source PDK
* **Measurement (Plan):** Digilent Analog Discovery 2/3
